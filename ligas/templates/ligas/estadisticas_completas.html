{% extends 'ligas/base.html' %}

{% block content %}
<style>
    h2 { color: #f4c430; font-size: 1.8em; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
    h3 { color: #f4c430; font-size: 1.3em; text-transform: uppercase; letter-spacing: 1px; margin: 30px 0 20px 0; }
    .liga-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #f4c430; }
    
    /* Stats cards */
    .stats-destacadas { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; margin-bottom: 30px; }
    .stat-card { background: #243447; border: 1px solid #3d4e60; border-left: 4px solid #f4c430; border-radius: 6px; padding: 20px; text-align: center; transition: all 0.3s; }
    .stat-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(244, 196, 48, 0.2); }
    .stat-card-titulo { font-size: 0.85em; color: #a0aec0; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
    .stat-card-valor { font-size: 2.2em; font-weight: bold; color: #f4c430; margin-bottom: 5px; }
    .stat-card-detalle { font-size: 0.95em; color: #fff; font-weight: 500; }
    
    /* GrÃ¡ficos */
    .grafico-container { background: #243447; border: 1px solid #3d4e60; border-radius: 8px; padding: 30px; margin-bottom: 30px; height: 400px; }
    
    .tabla { width: 100%; border-collapse: collapse; background: #243447; border: 1px solid #3d4e60; border-radius: 8px; overflow: hidden; margin-bottom: 30px; }
    .tabla th { background: #2d3e50; color: #f4c430; padding: 16px 12px; text-align: left; text-transform: uppercase; font-size: 0.85em; letter-spacing: 0.5px; border-bottom: 2px solid #f4c430; }
    .tabla td { padding: 14px 12px; border-bottom: 1px solid #3d4e60; color: #fff; }
    .tabla tr:hover { background: #2d3e50; }
    .tabla .posicion { font-weight: bold; color: #f4c430; width: 50px; text-align: center; font-size: 1.1em; }
    .tabla .equipo-nombre { font-weight: bold; font-size: 1em; }
    .tabla .numero { text-align: center; width: 70px; font-weight: 600; }
    .diferencia-positiva { color: #7cfc00; font-weight: bold; }
    .diferencia-negativa { color: #ff6b6b; font-weight: bold; }
    .tabla tbody tr:nth-child(1) .posicion { background: #ffd700; color: #0f1923; border-radius: 4px; }
    .tabla tbody tr:nth-child(2) .posicion { background: #c0c0c0; color: #0f1923; border-radius: 4px; }
    .tabla tbody tr:nth-child(3) .posicion { background: #cd7f32; color: #0f1923; border-radius: 4px; }
    
    /* Racha */
    .racha { display: flex; gap: 3px; justify-content: center; }
    .racha-item { width: 22px; height: 22px; display: inline-flex; align-items: center; justify-content: center; border-radius: 3px; font-size: 0.7em; font-weight: bold; }
    .racha-v { background: #1e4620; color: #7cfc00; }
    .racha-e { background: #4a3d1a; color: #ffd700; }
    .racha-d { background: #4a1a1a; color: #ff6b6b; }
    
    .btn-volver { display: inline-block; background: #243447; color: #f4c430; padding: 10px 20px; text-decoration: none; border-radius: 4px; border: 1px solid #f4c430; font-weight: bold; text-transform: uppercase; letter-spacing: 0.5px; transition: all 0.3s; margin-bottom: 20px; }
    .btn-volver:hover { background: #2d3e50; }
</style>

<a href="{% url 'ligas:home' %}" class="btn-volver">â¬…ï¸ Volver al Dashboard</a>

<div class="liga-header">
    <div>
        <h2>ğŸ“Š {{ liga.nombre }} - EstadÃ­sticas Completas</h2>
        {% if liga.pais %}
        <p style="color: #a0aec0;">ğŸ“ {{ liga.pais }}</p>
        {% endif %}
    </div>
    <a href="{% url 'ligas:lista_partidos' liga.id %}" style="background: #f4c430; color: #0f1923; padding: 12px 25px; text-decoration: none; border-radius: 4px; font-weight: bold; text-transform: uppercase; letter-spacing: 0.5px; transition: all 0.3s;">
        ğŸ“… Partidos
    </a>
</div>

<!-- EstadÃ­sticas Destacadas -->
<div class="stats-destacadas">
    {% if mas_puntos %}
    <div class="stat-card">
        <div class="stat-card-titulo">ğŸ† LÃ­der</div>
        <div class="stat-card-valor">{{ mas_puntos.puntos }}</div>
        <div class="stat-card-detalle">{{ mas_puntos.equipo.nombre }}</div>
    </div>
    {% endif %}
    
    {% if mejor_ataque %}
    <div class="stat-card">
        <div class="stat-card-titulo">âš½ Mejor Ataque</div>
        <div class="stat-card-valor">{{ mejor_ataque.goles_favor }}</div>
        <div class="stat-card-detalle">{{ mejor_ataque.equipo.nombre }}</div>
    </div>
    {% endif %}
    
    {% if mejor_defensa %}
    <div class="stat-card">
        <div class="stat-card-titulo">ğŸ›¡ï¸ Mejor Defensa</div>
        <div class="stat-card-valor">{{ mejor_defensa.goles_contra }}</div>
        <div class="stat-card-detalle">{{ mejor_defensa.equipo.nombre }}</div>
    </div>
    {% endif %}
    
    <div class="stat-card">
        <div class="stat-card-titulo">ğŸ¯ Partidos Jugados</div>
        <div class="stat-card-valor">{{ porcentaje_jugados }}%</div>
        <div class="stat-card-detalle">{{ total_partidos }} de {{ total_partidos_liga }} partidos</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-card-titulo">ğŸ“ˆ Total Goles</div>
        <div class="stat-card-valor">{{ total_goles }}</div>
        <div class="stat-card-detalle">En {{ total_partidos }} partidos</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-card-titulo">ğŸ“Š Promedio Goles</div>
        <div class="stat-card-valor">{{ promedio_goles }}</div>
        <div class="stat-card-detalle">Por partido</div>
    </div>
    
    {% if partidos_con_precision > 0 %}
    <div class="stat-card" style="border-left-color: {% if precision_promedio >= 70 %}#4ade80{% elif precision_promedio >= 50 %}#fbbf24{% else %}#ef4444{% endif %};">
        <div class="stat-card-titulo">ğŸ¯ PrecisiÃ³n General</div>
        <div class="stat-card-valor" style="color: {% if precision_promedio >= 70 %}#4ade80{% elif precision_promedio >= 50 %}#fbbf24{% else %}#ef4444{% endif %};">{{ precision_promedio }}%</div>
        <div class="stat-card-detalle">Todos los pronÃ³sticos ({{ partidos_con_precision }} partidos)</div>
    </div>
    {% endif %}
    
    {% if total_pronosticos_1x2 > 0 %}
    <div class="stat-card" style="border-left-color: {% if precision_1x2 >= 70 %}#4ade80{% elif precision_1x2 >= 50 %}#fbbf24{% else %}#ef4444{% endif %};">
        <div class="stat-card-titulo">ğŸ¯ PrecisiÃ³n 1X2</div>
        <div class="stat-card-valor" style="color: {% if precision_1x2 >= 70 %}#4ade80{% elif precision_1x2 >= 50 %}#fbbf24{% else %}#ef4444{% endif %};">{{ precision_1x2 }}%</div>
        <div class="stat-card-detalle">{{ aciertos_1x2 }} aciertos de {{ total_pronosticos_1x2 }} partidos</div>
    </div>
    {% endif %}
    
    {% if total_partidos_top3 > 0 %}
    <div class="stat-card" style="border-left-color: {% if precision_top3_promedio >= 66 %}#4ade80{% elif precision_top3_promedio >= 33 %}#fbbf24{% else %}#ef4444{% endif %};">
        <div class="stat-card-titulo">ğŸ† PrecisiÃ³n TOP 3</div>
        <div class="stat-card-valor" style="color: {% if precision_top3_promedio >= 66 %}#4ade80{% elif precision_top3_promedio >= 33 %}#fbbf24{% else %}#ef4444{% endif %};">{{ precision_top3_promedio }}%</div>
        <div class="stat-card-detalle">Promedio TOP 3 pronÃ³sticos ({{ total_partidos_top3 }} partidos)</div>
    </div>
    {% endif %}
</div>

<h3>ğŸ² EstadÃ­sticas Over/Under</h3>
<div class="stats-destacadas">
    <div class="stat-card">
        <div class="stat-card-titulo">ğŸ“ˆ Over 1.5</div>
        <div class="stat-card-valor">{{ porcentaje_over_15 }}%</div>
        <div class="stat-card-detalle">{{ over_15 }} partidos</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-card-titulo">ğŸ“‰ Under 1.5</div>
        <div class="stat-card-valor">{{ porcentaje_under_15 }}%</div>
        <div class="stat-card-detalle">{{ under_15 }} partidos</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-card-titulo">ğŸ“ˆ Over 2.5</div>
        <div class="stat-card-valor">{{ porcentaje_over_25 }}%</div>
        <div class="stat-card-detalle">{{ over_25 }} partidos</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-card-titulo">ğŸ“‰ Under 2.5</div>
        <div class="stat-card-valor">{{ porcentaje_under_25 }}%</div>
        <div class="stat-card-detalle">{{ under_25 }} partidos</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-card-titulo">ğŸ“ˆ Over 3.5</div>
        <div class="stat-card-valor">{{ porcentaje_over_35 }}%</div>
        <div class="stat-card-detalle">{{ over_35 }} partidos</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-card-titulo">ğŸ“‰ Under 3.5</div>
        <div class="stat-card-valor">{{ porcentaje_under_35 }}%</div>
        <div class="stat-card-detalle">{{ under_35 }} partidos</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-card-titulo">ğŸ“ˆ Over 4.5</div>
        <div class="stat-card-valor">{{ porcentaje_over_45 }}%</div>
        <div class="stat-card-detalle">{{ over_45 }} partidos</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-card-titulo">ğŸ“‰ Under 4.5</div>
        <div class="stat-card-valor">{{ porcentaje_under_45 }}%</div>
        <div class="stat-card-detalle">{{ under_45 }} partidos</div>
    </div>
</div>

<h3>âš½ Ambos Equipos Marcan (BTTS)</h3>
<div class="stats-destacadas">
    <div class="stat-card">
        <div class="stat-card-titulo">âœ… Ambos Marcan</div>
        <div class="stat-card-valor">{{ porcentaje_ambos_marcan }}%</div>
        <div class="stat-card-detalle">{{ ambos_marcan }} partidos</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-card-titulo">âŒ Ambos No Marcan</div>
        <div class="stat-card-valor">{{ porcentaje_ambos_no_marcan }}%</div>
        <div class="stat-card-detalle">{{ ambos_no_marcan }} partidos</div>
    </div>
</div>

<h3>ğŸ“Š Top 10 - Goleadores por Equipo</h3>
<div class="grafico-container">
    <canvas id="golesChart"></canvas>
</div>

<h3>ğŸ¯ DistribuciÃ³n de Victorias, Empates y Derrotas</h3>
<div class="grafico-container">
    <canvas id="resultadosChart"></canvas>
</div>

<h3>ğŸ“Š Histograma de Resultados (Goles por Partido)</h3>
<div class="grafico-container">
    <canvas id="histogramaChart"></canvas>
</div>

<h3>ğŸ¯ Resultados Exactos MÃ¡s Frecuentes (Top 15)</h3>
<div class="grafico-container">
    <canvas id="resultadosExactosChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// GrÃ¡fico de Goles por Equipo (Top 10)
const golesCtx = document.getElementById('golesChart').getContext('2d');
const equiposGoles = [
    {% for stat in estadisticas|slice:":10" %}
    '{{ stat.equipo.nombre }}',
    {% endfor %}
];
const golesFavor = [
    {% for stat in estadisticas|slice:":10" %}
    {{ stat.goles_favor }},
    {% endfor %}
];
const golesContra = [
    {% for stat in estadisticas|slice:":10" %}
    {{ stat.goles_contra }},
    {% endfor %}
];

new Chart(golesCtx, {
    type: 'bar',
    data: {
        labels: equiposGoles,
        datasets: [{
            label: 'Goles a Favor',
            data: golesFavor,
            backgroundColor: '#7cfc00',
            borderColor: '#7cfc00',
            borderWidth: 1
        }, {
            label: 'Goles en Contra',
            data: golesContra,
            backgroundColor: '#ff6b6b',
            borderColor: '#ff6b6b',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                labels: { color: '#fff', font: { size: 12 } }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: { color: '#a0aec0' },
                grid: { color: '#3d4e60' }
            },
            x: {
                ticks: { color: '#a0aec0', maxRotation: 45, minRotation: 45 },
                grid: { color: '#3d4e60' }
            }
        }
    }
});

// GrÃ¡fico de Resultados (Victorias, Empates, Derrotas)
const resultadosCtx = document.getElementById('resultadosChart').getContext('2d');
const totalVictorias = {{ estadisticas|length }} > 0 ? {% for stat in estadisticas %}{{ stat.victorias }}{% if not forloop.last %}+{% endif %}{% endfor %} : 0;
const totalEmpates = {{ estadisticas|length }} > 0 ? {% for stat in estadisticas %}{{ stat.empates }}{% if not forloop.last %}+{% endif %}{% endfor %} : 0;
const totalDerrotas = {{ estadisticas|length }} > 0 ? {% for stat in estadisticas %}{{ stat.derrotas }}{% if not forloop.last %}+{% endif %}{% endfor %} : 0;

new Chart(resultadosCtx, {
    type: 'doughnut',
    data: {
        labels: ['Victorias', 'Empates', 'Derrotas'],
        datasets: [{
            data: [totalVictorias, totalEmpates, totalDerrotas],
            backgroundColor: ['#7cfc00', '#ffd700', '#ff6b6b'],
            borderColor: '#243447',
            borderWidth: 2
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                labels: { color: '#fff', font: { size: 14 } },
                position: 'bottom'
            },
            tooltip: {
                callbacks: {
                    label: function(context) {
                        const label = context.label || '';
                        const value = context.parsed || 0;
                        const total = totalVictorias + totalEmpates + totalDerrotas;
                        const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                        return label + ': ' + value + ' (' + percentage + '%)';
                    }
                }
            }
        }
    }
});

// Histograma de Resultados (Goles por Partido)
const histogramaCtx = document.getElementById('histogramaChart').getContext('2d');
const histogramaLabels = [
    {% for label in histograma_labels %}
    '{{ label }} goles',
    {% endfor %}
];
const histogramaValores = [
    {% for valor in histograma_valores %}
    {{ valor }},
    {% endfor %}
];

new Chart(histogramaCtx, {
    type: 'bar',
    data: {
        labels: histogramaLabels,
        datasets: [{
            label: 'NÃºmero de Partidos',
            data: histogramaValores,
            backgroundColor: '#f4c430',
            borderColor: '#f4c430',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                labels: { color: '#fff', font: { size: 14 } }
            },
            tooltip: {
                callbacks: {
                    label: function(context) {
                        const value = context.parsed.y || 0;
                        const total = {{ total_partidos }};
                        const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                        return 'Partidos: ' + value + ' (' + percentage + '%)';
                    }
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: { 
                    color: '#a0aec0',
                    stepSize: 1
                },
                grid: { color: '#3d4e60' },
                title: {
                    display: true,
                    text: 'NÃºmero de Partidos',
                    color: '#f4c430',
                    font: { size: 14 }
                }
            },
            x: {
                ticks: { color: '#a0aec0' },
                grid: { color: '#3d4e60' },
                title: {
                    display: true,
                    text: 'Total de Goles en el Partido',
                    color: '#f4c430',
                    font: { size: 14 }
                }
            }
        }
    }
});

// Resultados Exactos MÃ¡s Frecuentes
const resultadosExactosCtx = document.getElementById('resultadosExactosChart').getContext('2d');
const resultadosExactosLabels = [
    {% for label in resultados_exactos_labels %}
    '{{ label }}',
    {% endfor %}
];
const resultadosExactosValores = [
    {% for valor in resultados_exactos_valores %}
    {{ valor }},
    {% endfor %}
];

new Chart(resultadosExactosCtx, {
    type: 'bar',
    data: {
        labels: resultadosExactosLabels,
        datasets: [{
            label: 'NÃºmero de Partidos',
            data: resultadosExactosValores,
            backgroundColor: '#7cfc00',
            borderColor: '#7cfc00',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        indexAxis: 'y',
        plugins: {
            legend: {
                labels: { color: '#fff', font: { size: 14 } }
            },
            tooltip: {
                callbacks: {
                    label: function(context) {
                        const value = context.parsed.x || 0;
                        const total = {{ total_partidos }};
                        const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                        return 'Partidos: ' + value + ' (' + percentage + '%)';
                    }
                }
            }
        },
        scales: {
            x: {
                beginAtZero: true,
                ticks: { 
                    color: '#a0aec0',
                    stepSize: 1
                },
                grid: { color: '#3d4e60' },
                title: {
                    display: true,
                    text: 'NÃºmero de Partidos',
                    color: '#f4c430',
                    font: { size: 14 }
                }
            },
            y: {
                ticks: { color: '#a0aec0' },
                grid: { color: '#3d4e60' },
                title: {
                    display: true,
                    text: 'Resultado (Local-Visitante)',
                    color: '#f4c430',
                    font: { size: 14 }
                }
            }
        }
    }
});
</script>

{% endblock %}
